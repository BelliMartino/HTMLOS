<!DOCTYPE html>
<html lang="it">
<head>
    <meta charset="UTF-8">
    <title>WebOS v1.5 - The Complete System</title>
    <style>
        :root {
            --bg-default: linear-gradient(135deg, #1e3c72, #2a5298);
            --glass: rgba(15, 15, 15, 0.9);
            --blur: blur(20px);
            --accent: #0078d4;
        }

        body, html { margin: 0; height: 100%; font-family: 'Segoe UI', sans-serif; overflow: hidden; color: white; transition: filter 0.3s; }
        #desktop { width: 100%; height: calc(100% - 50px); background: var(--bg-default); position: relative; overflow: hidden; }

        /* Icone Desktop */
        .grid-icons { display: grid; grid-template-columns: repeat(auto-fill, 90px); gap: 10px; padding: 20px; }
        .icon { width: 80px; text-align: center; cursor: pointer; border-radius: 8px; padding: 10px; transition: 0.2s; z-index: 5; }
        .icon:hover { background: rgba(255,255,255,0.1); }
        .icon img { width: 40px; display: block; margin: 0 auto 5px; pointer-events: none; }
        .icon span { font-size: 11px; text-shadow: 1px 1px 2px black; pointer-events: none; }

        /* Finestre */
        .window {
            position: absolute; width: 550px; height: 400px;
            background: rgba(30, 30, 30, 0.95); backdrop-filter: var(--blur);
            border: 1px solid rgba(255,255,255,0.2); border-radius: 12px;
            display: none; flex-direction: column; box-shadow: 0 15px 40px rgba(0,0,0,0.6);
            z-index: 10; overflow: hidden;
        }
        .window-header {
            padding: 10px 15px; background: rgba(255,255,255,0.05);
            display: flex; justify-content: space-between; align-items: center;
            cursor: move; border-bottom: 1px solid rgba(255,255,255,0.1);
        }
        .window-content { flex: 1; position: relative; overflow: auto; padding: 10px; }
        .btn-action { background: #444; color: white; border: none; padding: 4px 10px; border-radius: 4px; cursor: pointer; font-size: 11px; margin-right: 5px; }
        .btn-action:hover { background: var(--accent); }
        .close-btn { background: #ff5f56; border: none; width: 14px; height: 14px; border-radius: 50%; cursor: pointer; }

        /* Taskbar */
        #taskbar {
            height: 50px; background: rgba(0,0,0,0.9); backdrop-filter: var(--blur);
            position: absolute; bottom: 0; width: 100%;
            display: flex; align-items: center; padding: 0 15px; box-sizing: border-box; z-index: 9999;
        }
        .start-btn { padding: 8px 15px; background: var(--accent); border-radius: 5px; cursor: pointer; font-weight: bold; margin-right: 15px; }
        #task-manager-list { display: flex; gap: 5px; flex: 1; overflow-x: auto; }
        .task-tab { background: #333; padding: 5px 12px; border-radius: 4px; font-size: 11px; cursor: pointer; border: 1px solid #555; white-space: nowrap; }
        #clock { cursor: pointer; padding: 5px 10px; border-radius: 5px; font-size: 14px; margin-left: auto; }

        /* Browser Tabs */
        .tabs-bar { display: flex; gap: 2px; background: #222; padding: 5px 5px 0 5px; }
        .tab-btn { background: #444; color: white; border: none; padding: 5px 10px; cursor: pointer; font-size: 11px; border-radius: 4px 4px 0 0; }
        .tab-btn.active { background: var(--accent); }
        .url-bar { display: flex; gap: 5px; background: #222; padding: 5px; border-bottom: 1px solid #444; }
        .url-bar input { flex: 1; background: #333; border: 1px solid #555; color: white; padding: 4px; border-radius: 4px; }
        .tab-content { display: none; width: 100%; height: 100%; border: none; background: white; }
        .tab-content.active { display: block; }

        /* Widgets */
        #calendarWidget, #startMenu {
            position: absolute; bottom: 60px; background: var(--glass); backdrop-filter: var(--blur);
            border-radius: 12px; padding: 15px; display: none; z-index: 10000; border: 1px solid #444;
        }
        #calendarWidget { right: 10px; width: 220px; }
        #startMenu { left: 10px; width: 250px; }
        .menu-item { padding: 10px; cursor: pointer; border-radius: 8px; display: flex; align-items: center; gap: 10px; }
        .menu-item:hover { background: rgba(255,255,255,0.1); }

        /* App Specific */
        #termOut { font-family: monospace; color: #0f0; white-space: pre-wrap; }
        #termIn { background: transparent; border: none; color: #0f0; outline: none; width: 90%; font-family: monospace; }
        textarea { width: 100%; height: 95%; background: transparent; color: white; border: none; outline: none; resize: none; font-size: 16px; }
        canvas { background: white; cursor: crosshair; display: block; }
    </style>
</head>
<body>

<div id="desktop" onclick="hideWidgets()">
    <div class="grid-icons">
        <div class="icon" onclick="openApp('noteApp', 'Note')"><img src="https://cdn-icons-png.flaticon.com/512/3075/3075908.png"><span>Note</span></div>
        <div class="icon" onclick="openApp('paintApp', 'Paint')"><img src="https://cdn-icons-png.flaticon.com/512/3595/3595562.png"><span>Paint</span></div>
        <div class="icon" onclick="openApp('termApp', 'Terminale')"><img src="https://cdn-icons-png.flaticon.com/512/906/906343.png"><span>Terminale</span></div>
        <div class="icon" onclick="openApp('browserApp', 'Browser')"><img src="https://cdn-icons-png.flaticon.com/512/888/888846.png"><span>Browser</span></div>
        <div class="icon" onclick="openApp('settingsApp', 'Sistema')"><img src="https://cdn-icons-png.flaticon.com/512/2040/2040504.png"><span>Sistema</span></div>
    </div>

    <div id="startMenu" onclick="event.stopPropagation()">
        <div class="menu-item" onclick="openApp('settingsApp', 'Sistema')">‚öôÔ∏è Impostazioni</div>
        <div class="menu-item" onclick="openApp('termApp', 'Terminale')">üíª Terminale</div>
        <hr style="opacity:0.2">
        <div class="menu-item" onclick="location.reload()">üîÑ Riavvia Sistema</div>
    </div>

    <div id="calendarWidget" onclick="event.stopPropagation()">
        <h4 id="calMonth" style="margin:0 0 10px 0">Calendario</h4>
        <div id="calDays" style="font-family: monospace; font-size: 13px; line-height: 1.6;"></div>
    </div>

    <div id="browserApp" class="window" style="width: 750px; height: 500px;">
        <div class="window-header" onmousedown="makeDraggable(this.parentElement)">
            <span>Browser Web</span>
            <button class="close-btn" onclick="closeApp('browserApp')"></button>
        </div>
        <div class="tabs-bar">
            <button class="tab-btn active" onclick="switchTab(0)">Tab 1</button>
            <button class="tab-btn" onclick="switchTab(1)">Tab 2</button>
            <button class="tab-btn" onclick="switchTab(2)">Tab 3</button>
            <button class="tab-btn" onclick="switchTab(3)">Tab 4</button>
        </div>
        <div class="url-bar">
            <input type="text" id="browserUrl" value="https://www.wikipedia.org">
            <button class="btn-action" onclick="naviga()">Vai</button>
        </div>
        <div class="window-content" style="padding:0;">
            <iframe id="tab0" class="tab-content active" src="https://www.wikipedia.org"></iframe>
            <iframe id="tab1" class="tab-content" src=""></iframe>
            <iframe id="tab2" class="tab-content" src=""></iframe>
            <iframe id="tab3" class="tab-content" src=""></iframe>
        </div>
    </div>

    <div id="noteApp" class="window">
        <div class="window-header" onmousedown="makeDraggable(this.parentElement)">
            <span>Blocco Note</span>
            <div><button class="btn-action" onclick="saveNote()">Salva .txt</button><button class="close-btn" onclick="closeApp('noteApp')"></button></div>
        </div>
        <div class="window-content"><textarea id="notepad" placeholder="Scrivi qui..."></textarea></div>
    </div>

    <div id="termApp" class="window">
        <div class="window-header" onmousedown="makeDraggable(this.parentElement)">
            <span>Terminale</span>
            <button class="close-btn" onclick="closeApp('termApp')"></button>
        </div>
        <div class="window-content" style="background:black;" onclick="document.getElementById('termIn').focus()">
            <div id="termOut">WebOS v1.5 Gold<br>Digita 'help' per i comandi.</div>
            <div style="display:flex; color:#0f0;">> <input type="text" id="termIn" autocomplete="off" style="margin-left:5px"></div>
        </div>
    </div>

    <div id="paintApp" class="window" style="width: 600px; height: 450px;">
        <div class="window-header" onmousedown="makeDraggable(this.parentElement)">
            <span>Paint</span>
            <div style="display:flex; align-items:center; gap:5px;">
                <input type="color" id="paintColor" value="#000000">
                <button class="btn-action" onclick="savePaint()">Esporta PNG</button>
                <button class="close-btn" onclick="closeApp('paintApp')"></button>
            </div>
        </div>
        <div class="window-content" style="padding:0; background:#eee;"><canvas id="canvas"></canvas></div>
    </div>

    <div id="settingsApp" class="window" style="width: 400px; height: 500px;">
        <div class="window-header" onmousedown="makeDraggable(this.parentElement)">
            <span>Impostazioni</span>
            <button class="close-btn" onclick="closeApp('settingsApp')"></button>
        </div>
        <div class="window-content">
            <h4>Sistema</h4>
            <p style="font-size:12px; opacity:0.7;">Versione: 1.5 | Build: 1000.00</p>
            <hr>
            <h4>Personalizzazione</h4>
            <label>Sfondo Desktop:</label> <input type="color" onchange="document.getElementById('desktop').style.background=this.value">
            <hr>
            <h4>Accessibilit√†</h4>
            <div style="display:flex; justify-content:space-between; margin:10px 0;">
                <span>Contrasto Alto</span> <input type="checkbox" onchange="toggleAccess('contrast', this.checked)">
            </div>
            <div style="display:flex; justify-content:space-between; margin:10px 0;">
                <span>Inverti Colori</span> <input type="checkbox" onchange="toggleAccess('invert', this.checked)">
            </div>
            <div style="display:flex; justify-content:space-between; margin:10px 0;">
                <span>Testo Grassetto</span> <input type="checkbox" onchange="document.body.style.fontWeight = this.checked ? 'bold' : 'normal'">
            </div>
        </div>
    </div>
</div>

<div id="taskbar">
    <div class="start-btn" onclick="event.stopPropagation(); toggleWidget('startMenu')">START</div>
    <div id="task-manager-list"></div>
    <div id="clock" onclick="event.stopPropagation(); toggleWidget('calendarWidget')">00:00:00</div>
</div>

<script>
    let zIdx = 100;
    let activeApps = new Map();
    let currentBrowserTab = 0;

    // --- LOGICA UI & FINESTRE ---
    function openApp(id, name) {
        const win = document.getElementById(id);
        win.style.display = 'flex';
        win.style.zIndex = ++zIdx;
        activeApps.set(id, name);
        updateTaskManager();
        if(id === 'paintApp') setTimeout(initPaint, 100);
        hideWidgets();
    }

    function closeApp(id) {
        document.getElementById(id).style.display = 'none';
        activeApps.delete(id);
        updateTaskManager();
    }

    function updateTaskManager() {
        const list = document.getElementById('task-manager-list');
        list.innerHTML = '';
        activeApps.forEach((name, id) => {
            const tab = document.createElement('div');
            tab.className = 'task-tab';
            tab.innerText = name;
            tab.onclick = () => { document.getElementById(id).style.zIndex = ++zIdx; };
            list.appendChild(tab);
        });
    }

    function toggleWidget(id) {
        const w = document.getElementById(id);
        const vis = w.style.display === 'block';
        hideWidgets();
        w.style.display = vis ? 'none' : 'block';
        if(id === 'calendarWidget') updateCalendar();
    }

    function hideWidgets() {
        document.getElementById('calendarWidget').style.display = 'none';
        document.getElementById('startMenu').style.display = 'none';
    }

    function makeDraggable(el) {
        let p1=0, p2=0, p3=0, p4=0;
        el.onmousedown = (e) => {
            if(e.target.classList.contains('btn-action') || e.target.type === 'color') return;
            el.style.zIndex = ++zIdx;
            p3 = e.clientX; p4 = e.clientY;
            document.onmouseup = () => { document.onmouseup = null; document.onmousemove = null; };
            document.onmousemove = (e) => {
                p1 = p3 - e.clientX; p2 = p4 - e.clientY;
                p3 = e.clientX; p4 = e.clientY;
                el.style.top = (el.offsetTop - p2) + "px";
                el.style.left = (el.offsetLeft - p1) + "px";
            };
        };
    }

    // --- LOGICA BROWSER ---
    function switchTab(idx) {
        currentBrowserTab = idx;
        document.querySelectorAll('.tab-btn').forEach((b, i) => b.classList.toggle('active', i === idx));
        document.querySelectorAll('.tab-content').forEach((f, i) => f.classList.toggle('active', i === idx));
        document.getElementById('browserUrl').value = document.getElementById('tab'+idx).src || "https://";
    }

    function naviga() {
        let url = document.getElementById('browserUrl').value;
        if(!url.startsWith('http')) url = 'https://' + url;
        document.getElementById('tab' + currentBrowserTab).src = url;
    }

    // --- LOGICA TERMINALE ---
    document.getElementById('termIn').addEventListener('keydown', function(e) {
        if(e.key === 'Enter') {
            const out = document.getElementById('termOut');
            const cmd = this.value.toLowerCase().trim();
            out.innerHTML += `\n> ${this.value}`;
            if(cmd === 'help') out.innerHTML += "\nComandi: help, clear, date, about";
            else if(cmd === 'clear') out.innerHTML = "Terminale Pulito.";
            else if(cmd === 'date') out.innerHTML += `\n${new Date()}`;
            else if(cmd === 'about') out.innerHTML += "\nWebOS v1.5 Complete Edition.";
            else if(cmd !== "") out.innerHTML += `\nComando '${cmd}' non trovato.`;
            this.value = "";
            out.parentElement.scrollTop = out.parentElement.scrollHeight;
        }
    });

    // --- LOGICA PAINT ---
    let canvas = document.getElementById('canvas'), ctx = canvas.getContext('2d'), drawing = false;
    function initPaint() {
        canvas.width = canvas.parentElement.clientWidth;
        canvas.height = canvas.parentElement.clientHeight;
        canvas.onmousedown = () => drawing = true;
        canvas.onmouseup = () => { drawing = false; ctx.beginPath(); };
        canvas.onmousemove = (e) => {
            if(!drawing) return;
            ctx.lineWidth = 3; ctx.lineCap = 'round';
            ctx.strokeStyle = document.getElementById('paintColor').value;
            const r = canvas.getBoundingClientRect();
            ctx.lineTo(e.clientX - r.left, e.clientY - r.top);
            ctx.stroke(); ctx.beginPath(); ctx.moveTo(e.clientX - r.left, e.clientY - r.top);
        };
    }

    // --- SALVATAGGI ---
    function saveNote() {
        const b = new Blob([document.getElementById('notepad').value], {type: "text/plain"});
        const a = document.createElement("a"); a.href = URL.createObjectURL(b);
        a.download = "nota.txt"; a.click();
    }
    function savePaint() {
        const a = document.createElement('a'); a.href = canvas.toDataURL();
        a.download = 'disegno.png'; a.click();
    }

    // --- ACCESSIBILIT√Ä & OROLOGIO ---
    let filters = { contrast: false, invert: false };
    function toggleAccess(type, val) {
        filters[type] = val;
        let s = "";
        if(filters.contrast) s += "contrast(200%) ";
        if(filters.invert) s += "invert(100%) ";
        document.body.style.filter = s || "none";
    }

    function updateCalendar() {
        const d = new Date();
        document.getElementById('calMonth').innerText = d.toLocaleString('it-IT', { month: 'long', year: 'numeric' });
        let h = "";
        for(let i=1; i<=31; i++) {
            h += (i === d.getDate() ? `<b style="color:var(--accent)">[${i}]</b> ` : i + " ");
            if(i % 7 === 0) h += "<br>";
        }
        document.getElementById('calDays').innerHTML = h;
    }

    setInterval(() => { document.getElementById('clock').innerText = new Date().toLocaleTimeString(); }, 1000);
</script>

</body>
</html>
